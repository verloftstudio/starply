<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: #000000;
            --text-color: #ffffff;
            --accent-rgba: rgba(255, 255, 255, 0.1);
        }

        /* Блокируем скролл и фиксируем высоту */
        html, body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            height: 100vh;
            width: 100vw;
            overflow: hidden; /* Не дает окну дергаться */
            position: fixed; 
        }

        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }

        /* Шапка из прошлого шага */
        .balance-card {
            display: inline-flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.07);
            backdrop-filter: blur(15px);
            border-radius: 100px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            height: 44px;
            overflow: hidden;
            align-self: flex-start;
        }

        .user-section {
            display: flex;
            align-items: center;
            padding: 0 12px 0 6px;
            gap: 8px;
        }

        .avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
        }

        .full-divider {
            width: 1px;
            height: 100%;
            background: rgba(255, 255, 255, 0.15);
        }

        .stars-section {
            display: flex;
            align-items: center;
            padding: 0 14px;
            gap: 6px;
        }

        /* --- АНИМИРОВАННЫЙ СЧЕТЧИК --- */
        .odometer-container {
            display: flex;
            font-size: 18px;
            font-weight: 700;
            font-family: 'Courier New', Courier, monospace; /* Моноширинный для четкости */
        }

        .digit-wrapper {
            height: 1.2em;
            overflow: hidden;
            line-height: 1.2em;
            position: relative;
        }

        .digit-strip {
            display: flex;
            flex-direction: column;
            transition: transform 0.3s cubic-bezier(0, 0, 0.2, 1); /* Плавная остановка */
        }

        /* Центральная кнопка */
        .main-content {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .mine-button {
            background: #fff;
            color: #000;
            border: none;
            padding: 20px 40px;
            border-radius: 20px;
            font-size: 20px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.2);
            transition: transform 0.1s;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
        }

        .mine-button:active {
            transform: scale(0.92); /* Эффект нажатия */
            background: #e0e0e0;
        }

    </style>
</head>
<body>

    <div class="app-container">
        <div class="balance-card">
            <div class="user-section">
                <img id="avatar" class="avatar" src="https://via.placeholder.com/100" alt="">
                <span id="name" style="font-size: 14px; font-weight: 600;">User</span>
            </div>
            <div class="full-divider"></div>
            <div class="stars-section">
                <div id="odometer" class="odometer-container"></div>
                <svg width="14" height="14" viewBox="0 0 14 15" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M6.63869 12.1902L3.50621 14.1092C3.18049 14.3087 2.75468 14.2064 2.55515 13.8807C2.45769 13.7216 2.42864 13.5299 2.47457 13.3491L2.95948 11.4405C3.13452 10.7515 3.60599 10.1756 4.24682 9.86791L7.6642 8.22716C7.82352 8.15067 7.89067 7.95951 7.81418 7.80019C7.75223 7.67116 7.61214 7.59896 7.47111 7.62338L3.66713 8.28194C2.89387 8.41581 2.1009 8.20228 1.49941 7.69823L0.297703 6.69116C0.00493565 6.44581 -0.0335059 6.00958 0.211842 5.71682C0.33117 5.57442 0.502766 5.48602 0.687982 5.47153L4.35956 5.18419C4.61895 5.16389 4.845 4.99974 4.94458 4.75937L6.36101 1.3402C6.5072 0.987302 6.91179 0.819734 7.26469 0.965925C7.43413 1.03612 7.56876 1.17075 7.63896 1.3402L9.05539 4.75937C9.15496 4.99974 9.38101 5.16389 9.6404 5.18419L13.3322 5.47311C13.713 5.50291 13.9975 5.83578 13.9677 6.2166C13.9534 6.39979 13.8667 6.56975 13.7269 6.68896L10.9114 9.08928C10.7131 9.25826 10.6267 9.52425 10.6876 9.77748L11.5532 13.3733C11.6426 13.7447 11.414 14.1182 11.0427 14.2076C10.8642 14.2506 10.676 14.2208 10.5195 14.1249L7.36128 12.1902C7.13956 12.0544 6.8604 12.0544 6.63869 12.1902Z" fill="white"/></svg>
            </div>
        </div>

        <div class="main-content">
            <button class="mine-button" onclick="mine()">Майнить Звезды</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        // Запрещаем вертикальный свайп для закрытия (важно для игр)
        tg.disableVerticalSwipe();

        let StarsCount = 0.000000;

        // --- ЛОГИКА СЧЕТЧИКА "КАЗИНО" ---
        function createOdometer(id, value) {
            const container = document.getElementById(id);
            const str = value.toFixed(6);
            container.innerHTML = '';

            [...str].forEach((char) => {
                const wrapper = document.createElement('div');
                wrapper.className = 'digit-wrapper';
                
                if (char === '.') {
                    wrapper.innerText = '.';
                } else {
                    const strip = document.createElement('div');
                    strip.className = 'digit-strip';
                    for (let i = 0; i <= 9; i++) {
                        const digit = document.createElement('div');
                        digit.innerText = i;
                        strip.appendChild(digit);
                    }
                    wrapper.appendChild(strip);
                    wrapper.dataset.digit = char;
                    updateStrip(strip, char);
                }
                container.appendChild(wrapper);
            });
        }

        function updateStrip(strip, digit) {
            const y = digit * 1.2; // 1.2em - высота одной цифры
            strip.style.transform = `translateY(-${y}em)`;
        }

        function refreshOdometer(value) {
            const str = value.toFixed(6);
            const wrappers = document.querySelectorAll('.digit-wrapper');
            
            [...str].forEach((char, i) => {
                if (char !== '.' && wrappers[i]) {
                    const strip = wrappers[i].querySelector('.digit-strip');
                    if (strip) updateStrip(strip, char);
                }
            });
        }

        // Первичная отрисовка
        createOdometer('odometer', StarsCount);

        function mine() {
            StarsCount += 0.000001;
            refreshOdometer(StarsCount);
            
            // Легкая вибрация при нажатии (только на мобилках)
            if (tg.HapticFeedback) {
                tg.HapticFeedback.impactOccurred('light');
            }
        }

        // Данные пользователя
        const user = tg.initDataUnsafe?.user;
        if (user) {
            document.getElementById('name').textContent = user.first_name;
            if (user.photo_url) document.getElementById('avatar').src = user.photo_url;
        }
    </script>
</body>
</html>
